server {
  listen 80 default_server;
  listen [::]:80 default_server;

  server_name virmaautospares.com www.virmaautospares.com;

  listen 443 ssl; # managed by Certbot

  # RSA certificate
  ssl_certificate /etc/letsencrypt/live/virmaautospares.com/fullchain.pem; # managed by Certbot
  ssl_certificate_key /etc/letsencrypt/live/virmaautospares.com/privkey.pem; # managed by Certbot

  include /etc/letsencrypt/options-ssl-nginx.conf; # managed by Certbot

  # Redirect non-https traffic to https
  if ($scheme != "https") {
    return 301 https://$host$request_uri;
  } # managed by Certbot

  client_max_body_size 32M;
  root /home/deploy/marv/current/public;

  passenger_enabled on;
  passenger_ruby /home/decidim/.rbenv/shims/ruby;
  passenger_app_env production;

  location /cable {
    passenger_app_group_name myapp_websocket;
    passenger_force_max_concurrent_requests_per_process 0;
  }

  location ~* .(jpg|jpeg|mp3|eot|png|svg|ttf|woff|swf|gif|ico|css|js)(.*)$ {
    gzip_static on;
    expires 1d;
    add_header Cache-Control public;
    add_header ETag  "";
  }

  location ~ ^/(assets|packs) {
    expires max;
    gzip_static on;
  }
}
